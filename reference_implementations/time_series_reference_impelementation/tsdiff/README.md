# TSDiff: An Unconditional Diffusion Model for Time Series

This codebase contains the implementation of the NeurIPS 2023 paper [*Predict, Refine, Synthesize: Self-Guiding Diffusion Models for Probabilistic Time Series Forecasting*](https://arxiv.org/abs/2307.11494). In this paper, they propose *TSDiff*, an unconditional diffusion model for time series. This proposed self-guidance mechanism enables conditioning TSDiff for downstream tasks during inference, without requiring auxiliary networks or altering the training procedure. Furthermore, the refinement scheme leverages the implicit density learned by the diffusion model to iteratively refine the predictions of base forecasters. Finally, they demonstrate the high quality of the synthetic time series by training downstrain models solely on generated data and introducing the *Linear Predictive Score (LPS)*.

## Overview

The primary contributions of this work include:

1. **Self-Guidance Mechanism**: This novel mechanism allows TSDiff to be conditioned for various downstream tasks during inference, without the need for auxiliary networks or changes to the training procedure.
2. **Refinement Scheme**: This scheme takes advantage of the implicit density learned by the diffusion model to iteratively improve the predictions made by base forecasters.
3. **Synthetic Data Generation**: They demonstrate the high quality of synthetic time series data generated by TSDiff. This is validated by training downstream models exclusively on the generated data and evaluating their performance on real datasets.
   
## Notebooks

The repository includes two key Jupyter notebooks that demonstrate the use of TSDiff:

1. **`forecasting.ipynb`**: This notebook provides a comprehensive demo for training the TSDiff model and using it for the forecasting task. It walks you through the entire process, from data preparation to model training and evaluation of forecasting performance.

2. **`synthetic_data.ipynb`**: This notebook demonstrates how to use TSDiff for generating synthetic datasets. It includes a detailed example of training various forecasters on the synthetic data generated by TSDiff and then testing these models on real datasets to assess their performance.


## Project Directory Structure and Description

## Root Directory

## bin/

- **guidance_experiment.py**: Script for running guidance experiments.
- **refinement_experiment.py**: Script for running refinement experiments.
- **train_cond_model.py**: Script for training a conditional model.
- **train_model.py**: Script for training the main model.
- **tstr_experiment.py**: Script for running TSTR (Train on Synthetic, Test on Real) experiments.

## configs/

- **guidance.yaml**: Configuration file for guidance experiments.
- **refinement.yaml**: Configuration file for refinement experiments.
- **training.yaml**: Configuration file for training models.

## src/

- Contains the source code for the project, including model definitions, training scripts, and utility functions.

## src/uncond_ts_diff/

- **__init__.py**: Initializes the uncond_ts_diff module.

### src/uncond_ts_diff/arch/

- **__init__.py**: Initializes the arch submodule.
- **backbones.py**: Defines backbone architectures for models.
- **s4.py**: S4 architecture implementation.

### src/uncond_ts_diff/metrics/

- **__init__.py**: Initializes the metrics submodule.
- **linear_pred_score.py**: Implements linear prediction scoring metrics.

### src/uncond_ts_diff/model/

- **__init__.py**: Initializes the model submodule.
- **callback.py**: Defines callback functions for model training.

#### src/uncond_ts_diff/model/diffusion/

- **__init__.py**: Initializes the diffusion submodule.
- **_base.py**: Base class for diffusion models.
- **tsdiff.py**: Implementation of the time-series diffusion model.
- **tsdiff_cond.py**: Implementation of the conditional time-series diffusion model.

#### src/uncond_ts_diff/model/linear/

- **_estimator.py**: Defines linear estimators for the models.
- **_scaler.py**: Defines scalers for data preprocessing.

### src/uncond_ts_diff/sampler/

- **__init__.py**: Initializes the sampler submodule.
- **_base.py**: Base class for samplers.
- **observation_guidance.py**: Implements observation guidance for sampling.
- **refiner.py**: Implements refining techniques for sampling.